<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8" />
    <title>Notificar Cliente - ProPrinter</title>
    <style>
        /* seu CSS já conhecido */
    </style>
</head>
<body>

<header>
    <img src="/static/proprinter.png" alt="Logo ProPrinter" />
</header>

<div class="container">
    <h2>Chamado #1234</h2>
    <p>Selecione o cliente para notificar:</p>

    <input type="text" id="filtro" placeholder="Buscar por nome..." onkeyup="filtrarClientes()">

    <form action="/avisar" method="post" onsubmit="return prepararEnvio()">
        <select name="nome_cliente" id="clienteSelect" required>
            <option value="" disabled selected>Selecione um cliente</option>
            <option value="Gustavo">Gustavo</option>
            <option value="Suporte">Suporte</option>
            <option value="Impressora">Impressora</option>
            <option value="Felipe">Felipe</option>
        </select><br>

        <label for="nome_tecnico">Nome do Técnico:</label><br>
        <select name="nome_tecnico" id="nome_tecnico" required>
            <option value="" disabled selected>Selecione o técnico</option>
            <option value="Gustavo">Gustavo</option>
            <option value="Felipe">Felipe</option>
        </select><br>

        <!-- Campos escondidos para latitude e longitude -->
        <input type="hidden" name="latitude" id="latitude" />
        <input type="hidden" name="longitude" id="longitude" />

        <button type="submit">Técnico a caminho</button>
    </form>
</div>

<script>
function filtrarClientes() {
    const input = document.getElementById("filtro");
    const filtro = input.value.toLowerCase();
    const select = document.getElementById("clienteSelect");
    const options = select.getElementsByTagName("option");

    for (let i = 0; i < options.length; i++) {
        const txt = options[i].textContent || options[i].innerText;
        if (i === 0) continue; // pula o "Selecione um cliente"
        options[i].style.display = txt.toLowerCase().includes(filtro) ? "" : "none";
    }
}

function prepararEnvio() {
    if (!navigator.geolocation) {
        alert("Geolocalização não suportada pelo seu navegador.");
        return false;
    }

    navigator.geolocation.getCurrentPosition(function(position) {
        document.getElementById('latitude').value = position.coords.latitude;
        document.getElementById('longitude').value = position.coords.longitude;

        // Submete o form após pegar a localização
        document.forms[0].submit();
    }, function(error) {
        alert("Erro ao obter localização: " + error.message);
    });

    // Impede o envio imediato para esperar a localização
    return false;
}
</script>

</body>
</html>
